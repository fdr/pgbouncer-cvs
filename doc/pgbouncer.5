.\"     Title: pgbouncer
.\"    Author: 
.\" Generator: DocBook XSL Stylesheets v1.73.2 <http://docbook.sf.net/>
.\"      Date: 04/09/2008
.\"    Manual: 
.\"    Source: 
.\"
.TH "PGBOUNCER" "5" "04/09/2008" "" ""
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.SH "NAME"
pgbouncer - Lightweight connection pooler for PostgreSQL.
.SH "SYNOPSIS"
.sp
.RS 4
.nf
[databases]
db = \.\.\.
.fi
.RE
.sp
.RS 4
.nf
[pgbouncer]
\.\.\.
.fi
.RE
.SH "DESCRIPTION"
Config file is in "ini" format\. Section names are between " and "\. Lines starting with ";" or "" are taken as comment and ignored\. The characters ";" and "" are not recognized when they appear later in the line\.
.sp
.SH "SECTION [PGBOUNCER]"
.SS "Generic settings"
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
logfile
.RS
Specifies log file\. Log file is kept open so after rotation kill \-HUP or on console RELOAD; should be done\.
.sp
Default: not set\.
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
pidfile
.RS
Specifies pid file\. Without pidfile, the daemonization is not allowed\.
.sp
Default: not set\.
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
listen_addr
.RS
Specifies IPv4 address, where to listen for TCP connections\. Or * meaning "listen on all addresses"\. When not set, only unix socket connections are allowed\.
.sp
Default: not set
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
listen_port
.RS
On which port to listen on\. Applies to both TCP and Unix sockets\.
.sp
Default: 6000
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
unix_socket_dir
.RS
Specifies location for Unix sockets\. Applies to both listening socket and server connections\. If set to empty string, Unix sockets are disabled\.
.sp
Default: /tmp
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
user
.RS
If set, specifies UNIX user to change to\. Work only if started as root or user is same as current user\.
.sp
Default: not set
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
auth_file
.RS
Load user names and passwords from this file\. File format used is same as for PostgreSQL pg_auth/pg_pwd file, so can be pointed directly to backend file\.
.sp
Default: not set\.
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
auth_type
.RS
How to authenticate users\.
.PP
md5
.RS 4
Use MD5\-based password check\.
auth_file
may contain both md5\-encrypted or plain\-text passwords\. Default\.
.RE
.PP
crypt
.RS 4
Use crypt(3) based bassword check\.
auth_file
must contain plain\-text passwords\.
.RE
.PP
plain
.RS 4
Clear\-text password is sent over wire\.
.RE
.PP
trust
.RS 4
No authentication is done\. Username must still exists in
auth_file\.
.RE
.PP
any
.RS 4
Like
trust
but username given is ignored\. Requires that all databases have configured to log in as specific user\.
.RE
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
pool_mode
.RS
Specifies when server connection is tagged as reusable for other clients\.
.PP
session
.RS 4
Server is released back to pool after client disconnects\. Default\.
.RE
.PP
transaction
.RS 4
Server is released back to pool after transaction finishes\.
.RE
.PP
statement
.RS 4
Server is released back to pool after query finishes\. Long transactions spanning multiple statements are disallowed in this mode\.
.RE
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
max_client_conn
.RS
Maximum number of client connections allowed\. When increased then the file descriptor limits should also be increased\. Note that actual number of file descriptiors used is more that max_client_conn\. Theoretical maximum used is:
.sp
.sp
.RS 4
.nf
max_client_conn + (max_pool_size * total_databases * total_users)
.fi
.RE
.sp
if each user connects under it\'s own username to server\. If database user is specified in connect string (all users connect under same username), the theoretical maximum is:
.sp
.sp
.RS 4
.nf
max_client_conn + (max_pool_size * total_databases)
.fi
.RE
.sp
The theoretical maximum should be never reached, unless somebody deliberately crafts special load for it\. Still, it means you should give fds liberately\.
.sp
Search for ulimit in your favourite shell man page\.
.sp
Default: 100
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
default_pool_size
.RS
How many server connection to allow per user/database pair\. Can be overrided in per\-database config\.
.sp
Default: 20
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
server_round_robin
.RS
By default, pgbouncer reuses server connections in LIFO manner, so that few connections get the most load\. This gives best performance if you have single server serving a database\. But if there is TCP round\-robin behind a database IP then it\'s better if pgbouncer also uses connections in that manner, thus achieving uniform load\.
.sp
Default: 0
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
ignore_startup_parameters
.RS
By default, PgBouncer allows only parameters it can keep track of in startup packets \- client_encoding, datestyle, timezone and standard_conforming_strings\.
.sp
All others raise error\. To allow others too, they can be specified here, so that pgbouncer knows that they have handled by admin and it can ignore them\.
.sp
Default: empty
.sp
.RE
.SS "Log settings"
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
log_connections
.RS
Log successful logins\.
.sp
Default: 1
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
log_disconnections
.RS
Log disconnections with reasons\.
.sp
Default: 1
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
log_pooler_errors
.RS
Log error messaged pooler sends to clients\.
.sp
Default: 1
.sp
.RE
.SS "Console access control"
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
admin_users
.RS
List of users that are allowed to run all commands on console\.
.sp
Default: empty
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
stats_users
.RS
List of users that are allowed to run read\-only queries on console\. Thats means all SHOW commands except SHOW FDS\.
.sp
Default: empty\.
.sp
.RE
.SS "Connection sanity checks, timeouts"
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
server_reset_query
.RS
Query send to server on connection release, before making it available to other clients\. At that moment no transaction is in progress so it should not include ABORT or ROLLBACK\.
.sp
Good choice for 8\.2 and below is:
.sp
.sp
.RS 4
.nf
server_reset_query = RESET ALL; SET SESSION AUTHORIZATION DEFAULT;
.fi
.RE
.sp
for 8\.3 and above its enough to do:
.sp
.sp
.RS 4
.nf
server_reset_query = DISCARD ALL;
.fi
.RE
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
server_check_delay
.RS
How long to keep released immidiately available, without running sanity\-check query on it\. If 0 then the query is ran always\.
.sp
Default: 30
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
server_check_query
.RS
Simple do\-nothing query to check if server connection is alive\.
.sp
If empty string, then sanity checking is disabled\.
.sp
Default: SELECT 1;
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
server_lifetime
.RS
Pooler tries to close server connections that are been connected longer than this\.
.sp
Default: 3600
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
server_idle_timeout
.RS
If server connection has been idle more than this then there\'s too many connections in the pool and this one can be dropped\.
.sp
Default: 600
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
server_connect_timeout
.RS
If connection and login wont finish in this time, the connection will be closed\.
.sp
Default: 15
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
server_login_retry
.RS
If login failed, because of failure from connect() or authentication that pooler waits this much before retrying to connect\.
.sp
Default: 15
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
client_login_timeout
.RS
If client connect but does not manage to login in this time, it will be disconnected\. Mainly needed to avoid dead connections stalling SUSPEND and thus online restart\.
.sp
Default: 60
.sp
.RE
.SS "Dangerous timeouts"
Setting following timeouts cause unexcpected errors\.
.sp
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
query_timeout
.RS
Queries running longer than that are canceled\. This should be used only with slightly smaller server\-side statement_timeout, to apply only for network problems\.
.sp
Default: 0 (disabled)
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
client_idle_timeout
.RS
Client connections idling longer than that are closed\. This should be larger then client\-side connection lifetime settings, to apply only for network problems\.
.sp
Default: 0 (disabled)
.sp
.RE
.SS "Low\-level network settings"
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
pkt_buf
.RS
Internal buffer size for packets\. Affects size of TCP packets sent and general memory usage\. Actual libpq packets can be larger than this so no need to set it large\.
.sp
Default: 2048
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
tcp_defer_accept
.RS
Details about following options shouldbe looked from man 7 tcp
.sp
Default: 45 on Linux, otherwise 0
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
tcp_socket_buffer
.RS
Default: not set
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
tcp_keepalive
.RS
Default: Not set
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
tcp_keepcnt
.RS
Default: not set
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
tcp_keepidle
.RS
Default: not set
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
tcp_keepintvl
.RS
Default: not set
.sp
.RE
.SH "SECTION [DATABASES]"
This contains key=value pairs where key will be taken as database name and value as libpq\-connstring style list of key=value pairs\. As actual libpq is not used, so not all features from libpq can be used (service=, quoting)\.
.sp
.SS "Location parameters"
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
dbname
.RS
Destination database name\.
.sp
Default: same as client\-side database name\.
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
host
.RS
IP\-address to connect to\.
.sp
Default: not set, meaning to use unix\-socket\.
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
port
.RS
Default: 5432
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
user, password
.RS
If user= is set, all connections to destination database will be done with that user, meaning that there will be only one pool for this database\.
.sp
Otherwise pgbouncer tries to log into destination database with client username, meaning that there will be one pool per user\.
.sp
.RE
.SS "Per\-database pool Size"
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
pool_size
.RS
Set maximum size of pools for this database\. If not set, the default_pool_size is used\.
.sp
.RE
.SS "Extra parameters"
They allow setting default parameters on server connection\.
.sp
Note that since version 1\.1 PgBouncer tracks client changes for their values, so their use in pgbouncer\.ini is deprecated now\.
.sp
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
client_encoding
.RS
Ask specific client_encoding from server\.
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
datestyle
.RS
Ask specific datestyle from server\.
.sp
.RE
.sp
.it 1 an-trap
.nr an-no-space-flag 1
.nr an-break-flag 1
.br
timezone
.RS
Ask specific timezone from server\.
.sp
.RE
.SH "EXAMPLE"
.SS "Minimal config"
.sp
.RS 4
.nf
[databases]
template1 = host=127\.0\.0\.1 dbname=template1
.fi
.RE
.sp
.RS 4
.nf
[pgbouncer]
pool_mode = session
listen_port = 6543
listen_addr = 127\.0\.0\.1
auth_type = md5
auth_file = users\.txt
logfile = pgbouncer\.log
pidfile = pgbouncer\.pid
admin_users = someuser
stats_users = stat_collector
.fi
.RE
.SS "Database defaults"
.sp
.RS 4
.nf
[databases]
.fi
.RE
.sp
.RS 4
.nf
; foodb over unix socket
foodb =
.fi
.RE
.sp
.RS 4
.nf
; redirect bardb to bazdb on localhost
bardb = host=127\.0\.0\.1 dbname=bazdb
.fi
.RE
.sp
.RS 4
.nf
; acceess to dest database will go with single user
forcedb = host=127\.0\.0\.1 port=300 user=baz password=foo client_encoding=UNICODE datestyle=ISO
.fi
.RE
.SH "SEE ALSO"
pgbouncer(1)
.sp
\fIhttps://developer\.skype\.com/SkypeGarage/DbProjects/PgBouncer\fR
.sp
